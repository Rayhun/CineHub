{% extends "accounts/base-profile.html" %}

{% block profile %}
<div class="profile-card p-4">
  <h3 class="mb-4">Download History</h3>
  {% if downloads %}
    <div class="history-list">
      {% for item in downloads %}
        <div class="history-item">
          <div class="history-poster">
            {% if item.movie.poster_url %}
              <img src="{{ item.movie.poster_url }}" alt="{{ item.movie.title }}">
            {% else %}
              <img src="https://via.placeholder.com/80x120?text={{ item.movie.title|urlencode }}" alt="{{ item.movie.title }}">
            {% endif %}
          </div>
          <div class="history-info">
            <h5>{{ item.movie.title }}</h5>
            <p>Downloaded on: {{ item.downloaded_at|date:"M d, Y" }}</p>
            {% if item.quality %}<p>Quality: {{ item.get_quality_display }}</p>{% endif %}
            {% if item.file_size %}<p>File Size: {{ item.file_size }}</p>{% endif %}
          </div>
          <div class="history-action">
            <a class="btn btn-sm btn-danger" href="{{ item.movie.get_download_url }}">Download Again</a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted mb-0">You haven't downloaded any movies yet.</p>
  {% endif %}
</div>
{% endblock %}
